<?
$list_page = "notice.html";
?>
<? include "../include/header_support.html"; ?>
<body>
<?
	$idxA = Replace_Check($idx);
	$pg = Replace_Check_XSS2($pg);
    $sw = Replace_Check_XSS2($sw);

    ##-- 페이지 조건
    if(!$pg) $pg = 1;
    $page_size = 25;
    $block_size = 10;

    ##-- 검색 조건
    $where = array();
    if($sw){
        $where[] = "(Title LIKE '%$sw%' OR Content LIKE '%$sw%')";
    }
    $where[] = "Del='N'";
    $where[] = "UseYN='Y'";

    $where = implode(" AND ",$where);
    if($where) $where = "WHERE $where";

    ##-- 정렬조건
    if($orderby=="") {
        $str_orderby = "ORDER BY RegDate DESC, idx DESC";
    }else{
        $str_orderby = "ORDER BY $orderby";
    }

    ##-- 검색 등록수
    $Sql = "SELECT COUNT(*) FROM NoticeCyber $where";
    $Result = mysqli_query($connect, $Sql);
    $Row = mysqli_fetch_array($Result);
    $TOT_NO = $Row[0];

    ##-- 페이지 클래스 생성
    include_once("../../include/include_page_support.php");

    $PAGE_CLASS = new Page($pg,$TOT_NO,$page_size,$block_size); ##-- 페이지 클래스
    $BLOCK_LIST = $PAGE_CLASS->blockList(); ##-- 페이지 이동관련
    $PAGE_UNCOUNT = $PAGE_CLASS->page_uncount; ##-- 게시물 번호 한개씩 감소
?>
    <div class="top_section">
        <div id="wrap">
            <div class="inner">
                <h2>공지사항</h2>
                <form name="BoardSearchForm" action="<?=$_SERVER['PHP_SELF']?>" method="GET">
	                <div class="search_box">
	                    <input name="sw" id="sw" type="text" title="검색어 입력" <?if($sw){?>value="<?=$sw?>"<?}?> placeholder="검색어를 입력해주세요">
	                    <span class="search_btn" onclick="Javascript:BoardSearch();"><i class="ph ph-magnifying-glass"></i></span>
	                </div>
                </form>
            </div>
            <div class="navi"><i class="ph-light ph-house-line"></i>&nbsp;<i class="ph ph-caret-right"></i>&nbsp;공지사항</div>
        </div>
        <!--wrap-->
    </div>
    <!--top_banner-->
    <div class="support_content">
        <div id="wrap">
            <div class="count">총 <span><?=$TOT_NO?></span>건</div>
            <ul class="notice">
            	<?
					$i = 0;
                    $SQL = "SELECT * FROM NoticeCyber WHERE Del='N' AND UseYN='Y' AND Notice='Y' ORDER BY RegDate DESC, idx DESC";
					$QUERY = mysqli_query($connect, $SQL);
                    if($QUERY && mysqli_num_rows($QUERY)){
                    	while($ROW = mysqli_fetch_array($QUERY)){
                        	extract($ROW);
                            $Title = strcut_utf8($Title,45);
							$Content = stripslashes($Content);
				?>
                <li>
                    <div id="ContentView"><span class="fcred">[공지]</span> <?=$Title?><i class="ph-bold ph-caret-up"></i></div>
                    <div id="ContentElement" style="display: none;">
                    	<?if($FileName1 || $FileName2 || $FileName3 || $FileName4 || $FileName5) { ?>
                   		<div class="file">
                            <span>DOWNLOAD<i class="ph-fill ph-arrow-fat-down"></i></span>
                            <ul>
                            	<?if($FileName1) { ?><li><img src="../img/common/file_down.png" alt="파일 다운로드"><a href="../../include/download.php?idx=<?=$idx?>&code=NoticeCyber&file=1"><?=$RealFileName1?></a></li><?}?>
                            	<?if($FileName2) { ?><li><img src="../img/common/file_down.png" alt="파일 다운로드"><a href="../../include/download.php?idx=<?=$idx?>&code=NoticeCyber&file=2"><?=$RealFileName2?></a></li><?}?>
                            	<?if($FileName3) { ?><li><img src="../img/common/file_down.png" alt="파일 다운로드"><a href="../../include/download.php?idx=<?=$idx?>&code=NoticeCyber&file=3"><?=$RealFileName3?></a></li><?}?>
                            	<?if($FileName4) { ?><li><img src="../img/common/file_down.png" alt="파일 다운로드"><a href="../../include/download.php?idx=<?=$idx?>&code=NoticeCyber&file=4"><?=$RealFileName4?></a></li><?}?>
                            	<?if($FileName5) { ?><li><img src="../img/common/file_down.png" alt="파일 다운로드"><a href="../../include/download.php?idx=<?=$idx?>&code=NoticeCyber&file=5"><?=$RealFileName5?></a></li><?}?>
                            </ul>
                        </div>
                    	<?}?>
                    	<?=$Content?>
                    </div>
                </li>
                <?
                	$i++;
					}
				}
				?>
				<?
					$i = 0;
                    $SQL = "SELECT * FROM NoticeCyber $where  AND Notice='N'  $str_orderby LIMIT $PAGE_CLASS->page_start, $page_size";
					$QUERY = mysqli_query($connect, $SQL);
                    if($QUERY && mysqli_num_rows($QUERY)){
                    	while($ROW = mysqli_fetch_array($QUERY)){
                        	extract($ROW);
                            $Title = strcut_utf8($Title,45);
							$Content = stripslashes($Content);
				?>
                <li>
                    <div id="ContentView"><?=$Title?><i class="ph-bold ph-caret-up"></i></div>
                    <div id="ContentElement" <?if($idxA!=$idx){?> style="display: none;" <?}?>  >
                        <?if($FileName1 || $FileName2 || $FileName3 || $FileName4 || $FileName5) { ?>
                   		<div class="file">
                            <span>DOWNLOAD<i class="ph-fill ph-arrow-fat-down"></i></span>
                            <ul>
                            	<?if($FileName1) { ?><li><img src="../img/common/file_down.png" alt="파일 다운로드"><a href="../../include/download.php?idx=<?=$idx?>&code=NoticeCyber&file=1"><?=$RealFileName1?></a></li><?}?>
                            	<?if($FileName2) { ?><li><img src="../img/common/file_down.png" alt="파일 다운로드"><a href="../../include/download.php?idx=<?=$idx?>&code=NoticeCyber&file=2"><?=$RealFileName2?></a></li><?}?>
                            	<?if($FileName3) { ?><li><img src="../img/common/file_down.png" alt="파일 다운로드"><a href="../../include/download.php?idx=<?=$idx?>&code=NoticeCyber&file=3"><?=$RealFileName3?></a></li><?}?>
                            	<?if($FileName4) { ?><li><img src="../img/common/file_down.png" alt="파일 다운로드"><a href="../../include/download.php?idx=<?=$idx?>&code=NoticeCyber&file=4"><?=$RealFileName4?></a></li><?}?>
                            	<?if($FileName5) { ?><li><img src="../img/common/file_down.png" alt="파일 다운로드"><a href="../../include/download.php?idx=<?=$idx?>&code=NoticeCyber&file=5"><?=$RealFileName5?></a></li><?}?>
                            </ul>
                        </div>
                    	<?}?>
                        <?=$Content?>
                    </div>
                </li>
                <?
                	$i++;
					}
				}
				?>
            </ul>
            
            <!-- page -->
            <?=$BLOCK_LIST?>
            <!-- //page -->
            
        </div>
        <!--wrap-->
    </div>
</body>
<? include "../include/footer.html"; ?>

<!--답변여닫기-->
<script>
    $(document).ready(function(){
        $('ul li #ContentView').click(function(){
            if($(this).next($('#ContentElement')).is(":visible")){
                $(this).find('i').toggleClass("ph-caret-up ph-caret-down");
                $(this).next($('#ContentElement')).slideUp();
            }else{
                $(this).find('i').toggleClass("ph-caret-down ph-caret-up");
                $(this).next($('#ContentElement')).slideDown();
            }
        });
    });
    
    function ViewClick(){
    	if($(this).next($('#ContentElement')).is(":visible")){
            $(this).find('i').toggleClass("ph-caret-up ph-caret-down");
            $(this).next($('#ContentElement')).slideUp();
        }else{
            $(this).find('i').toggleClass("ph-caret-down ph-caret-up");
            $(this).next($('#ContentElement')).slideDown();
        }
    }
</script>